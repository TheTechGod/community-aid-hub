<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Food | Chicago SNAP Assistance Hub</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <!-- âœ… Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">SNAP Assistance</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="food.html">Find Food</a></li>
          <li class="nav-item"><a class="nav-link" href="updates.html">Updates</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- âœ… Header -->
  <section class="hero text-center text-light d-flex align-items-center" style="min-height: 40vh;">
    <div class="container">
      <h1 class="fw-bold">Find Food Pantries & Community Markets</h1>
      <p class="lead">Search by ZIP code, neighborhood, or type of service.</p>
    </div>
  </section>

  <!-- âœ… Search + Filters -->
  <main class="container py-5">
    <div class="row mb-4 align-items-center">
      <div class="col-md-5 mb-2">
        <input id="searchInput" type="text" class="form-control" placeholder="Enter ZIP or neighborhood...">
      </div>

      <div class="col-md-3 mb-2">
        <select id="serviceFilter" class="form-select">
          <option value="">All Services</option>
          <option value="Groceries">Groceries</option>
          <option value="Hot meals">Hot Meals</option>
          <option value="Drive-through food distribution">Drive-Through</option>
          <option value="Fresh produce">Fresh Produce</option>
        </select>
      </div>

      <div class="col-md-4 mb-2">
        <div class="btn-group w-100">
          <button class="btn btn-outline-primary" id="sortAZ">Sort Aâ€“Z</button>
          <button class="btn btn-outline-secondary" id="sortCommunity">Sort by Community</button>
          <button class="btn btn-outline-danger" id="resetFilters">Reset</button>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div id="results" class="row g-4"></div>
  </main>

  <!-- âœ… Footer -->
  <footer class="bg-dark text-light text-center py-3 mt-auto">
    <p class="mb-0 small">
      Â© <span id="year"></span> <a href="https://integrity-programming-portfolio-sta.vercel.app/" target="_blank">Integrity Programming |
      Built by Geoffrey D. Metzger</a>
    </p>
  </footer>

    <!-- âœ… Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  let allPantries = [];

  async function loadPantries() {
    try {
      const res = await fetch("data/pantries.json");
      allPantries = await res.json();
      renderResults(allPantries);
    } catch (err) {
      console.error("Error loading data", err);
      document.getElementById("results").innerHTML =
        "<p class='text-danger'>Unable to load pantry data.</p>";
    }
  }

  function renderResults(pantries) {
    const list = document.getElementById("results");
    if (pantries.length === 0) {
      list.innerHTML = "<p class='text-muted'>No results found.</p>";
      return;
    }

    list.innerHTML = pantries
      .map(
        (p) => `
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h5 class="fw-bold">${p.name}</h5>
            <p class="mb-1">${p.address}</p>
            <p class="mb-1"><strong>Hours:</strong> ${p.hours || "Varies"}</p>
            <p class="mb-1"><strong>Phone:</strong> ${p.phone || "â€”"}</p>
            <p class="small text-muted mb-2">${p.community || ""}</p>
            <span class="badge bg-primary">${p.services?.[0] || "Food Pantry"}</span>
          </div>
        </div>
      </div>`
      )
      .join("");
  }

  function filterAndSort() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const serviceFilter = document.getElementById("serviceFilter").value;
    let filtered = allPantries.filter(
      (p) =>
        p.zip?.startsWith(query) ||
        p.address.toLowerCase().includes(query) ||
        p.community?.toLowerCase().includes(query)
    );

    if (serviceFilter) {
      filtered = filtered.filter((p) =>
        p.services?.some((s) => s.toLowerCase().includes(serviceFilter.toLowerCase()))
      );
    }

    // Toggle reset button visibility
    const resetBtn = document.getElementById("resetFilters");
    if (query || serviceFilter) {
      resetBtn.style.visibility = "visible";
    } else {
      resetBtn.style.visibility = "hidden";
    }

    renderResults(filtered);
  }

  document.getElementById("searchInput").addEventListener("input", filterAndSort);
  document.getElementById("serviceFilter").addEventListener("change", filterAndSort);

  document.getElementById("sortAZ").addEventListener("click", () => {
    allPantries.sort((a, b) => a.name.localeCompare(b.name));
    renderResults(allPantries);
  });

  document.getElementById("sortCommunity").addEventListener("click", () => {
    allPantries.sort((a, b) =>
      (a.community || "").localeCompare(b.community || "")
    );
    renderResults(allPantries);
  });

  document.getElementById("resetFilters").addEventListener("click", () => {
    document.getElementById("searchInput").value = "";
    document.getElementById("serviceFilter").value = "";
    document.getElementById("resetFilters").style.visibility = "hidden";
    renderResults(allPantries);
  });

  // Initially hide the reset button
  document.getElementById("resetFilters").style.visibility = "hidden";

  loadPantries();
</script>


  <!-- Hit counter -->
  <script>
    fetch('https://api.countapi.xyz/hit/community-aid-hub.vercel.app/food')
      .then(res => res.json())
      .then(data => {
        const visitEl = document.createElement('p');
        visitEl.textContent = `ðŸ‘€ Page Visits: ${data.value}`;
        visitEl.style.fontSize = '0.8rem';
        visitEl.style.color = '#aaa';
        document.querySelector('footer').appendChild(visitEl);
      });
  </script>
</body>
</html>
